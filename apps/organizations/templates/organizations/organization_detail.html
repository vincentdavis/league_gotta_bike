{% extends "organizations/base.html" %}
{% load static %}

{% block title %}{{ organization.name }} - League Gotta Bike{% endblock %}

{% block content %}
<div class="px-4 sm:px-0">
    <!-- Breadcrumbs -->
    <nav class="mb-4">
        <ol class="flex items-center space-x-2 text-sm text-gray-500">
            <li><a href="{% url 'organizations:league_list' %}" class="hover:text-gray-700">Leagues</a></li>
            <li>/</li>
            <li><a href="{{ league.get_absolute_url }}" class="hover:text-gray-700">{{ league.name }}</a></li>
            <li>/</li>
            <li><a href="{{ team.get_absolute_url }}" class="hover:text-gray-700">{{ team.name }}</a></li>
            <li>/</li>
            <li class="text-gray-900">{{ organization.name }}</li>
        </ol>
    </nav>

    <!-- Organization Header -->
    <div class="bg-white shadow rounded-lg p-6 mb-6">
        <div class="flex items-start justify-between">
            <div class="flex items-center">
                <img src="{% if organization.logo %}{{ organization.logo.url }}{% else %}{% if organization.type == 'league' %}{% static 'images/Default_League.png' %}{% elif organization.type == 'team' %}{% static 'images/Default_Club.png' %}{% elif organization.type == 'squad' %}{% static 'images/Default_Squad.png' %}{% elif organization.type == 'club' %}{% static 'images/Default_Club.png' %}{% elif organization.type == 'practice_group' %}{% static 'images/Default_Practice_Group.png' %}{% else %}{% static 'images/Default_Team.png' %}{% endif %}{% endif %}" alt="{{ organization.name }}" class="h-20 w-20 rounded-full object-contain mr-4">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">{{ organization.name }}</h1>
                    <p class="text-gray-500 mt-1">{{ organization.get_type_display }} in {{ team.name }}</p>
                </div>
            </div>
            {% if can_edit %}
            <a href="{% url 'organizations:org_edit' slug=organization.slug %}" class="btn btn-primary btn-sm">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                </svg>
                Manage
            </a>
            {% endif %}
        </div>

        {% if organization.description %}
        <p class="text-gray-600 mt-4">{{ organization.description }}</p>
        {% endif %}

        <!-- Organization Profile Details -->
        {% if org_profile %}
        <div class="mt-6 grid grid-cols-1 gap-4 sm:grid-cols-3">
            {% if organization.contact_email %}
            <div>
                <p class="text-sm font-medium text-gray-500">Contact</p>
                <p class="mt-1 text-sm text-gray-900">{{ organization.contact_email }}</p>
            </div>
            {% endif %}
        </div>
        {% endif %}
    </div>

    <!-- Members -->
    <div class="bg-white shadow rounded-lg p-6">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Members</h2>

        {% if members %}
        <div class="grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-3">
            {% for membership in members %}
            <div class="p-3 border border-gray-200 rounded-lg">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <p class="font-medium text-gray-900">{{ membership.user.get_full_name }}</p>
                        <p class="text-sm text-gray-500">Joined: {{ membership.join_date|date:"M d, Y" }}</p>
                        <p class="text-sm text-gray-500">
                            {{ membership.get_permission_level_display }}{% if membership.member_roles.exists %} • {{ membership.get_roles_display }}{% else %} • <span class="text-gray-400 italic">No role assigned</span>{% endif %}
                        </p>
                        {% if can_edit %}
                        <div class="mt-2">
                            <a href="{% url 'membership:member_roles' slug=organization.slug membership_id=membership.id %}" class="text-xs text-blue-600 hover:text-blue-800">
                                {% if membership.member_roles.exists %}Edit roles{% else %}Assign role{% endif %}
                            </a>
                        </div>
                        {% endif %}
                    </div>
                    <span class="px-2 py-1 text-xs font-medium rounded-full
                        {% if membership.status == 'active' %}bg-green-100 text-green-800
                        {% elif membership.status == 'prospect' %}bg-yellow-100 text-yellow-800
                        {% else %}bg-gray-100 text-gray-800{% endif %}">
                        {{ membership.get_status_display }}
                    </span>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-gray-500">No members yet.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
